var UD={},_gaq=_gaq||[],option={ajaxTime:0,registerCheck:{username:true,email:false,password:true,confirm_password:true,captcha:true,agreement:true,phone_sn:true},loginCheck:false,userType:1};function Check(b){var a={};this.setting=b;b.elem.setting=b;this.addEvent()}Check.prototype={constructor:Check,addEvent:function(){var b=this.setting,a=b.elem;a.value=b.memberAucount||"";US.addEventListener(a,"focus",US.focusPrev);US.addEventListener(a,"blur",US.blurPrev);if(b.eventType){US.addEventListener(a,b.eventType,b.eventFunction)}if(b.firstFocus){if(/act=register/.test(location.search)&&!b.type){a.focus()}else{if(!/act=register/.test(location.search)&&b.type){b.memberAucount?(option.loginCheck=true):a.focus()}}}}};var US={getSmsCaptcha:function(){var a=M.$("#register_username").value;option.ajaxTime++;M.ajax({url:"/interface.html?act=get_mobile_captcha&mobile="+a+"&from=mobile",dataType:"json",cache:false,success:function(b){if(b&&!b.error){US.smsCaptchaTimer=120;M.$("#send_sms_captcha_wait").style.display="inline-block";M.$("#send_sms_captcha_a").style.display="none";M.$("#sms_captcha_s_a").style.display="none";US.countSmsCaptcha()}else{M.alert(b.msg)}option.ajaxTime--},error:function(){M.alert("获取短信验证码失败，请稍候再试。");option.ajaxTime--}})},countSmsCaptcha:function(){if(US.smsCaptchaTimer<=0){M.$("#send_sms_captcha_wait").style.display="none";M.$("#sms_capteha_send").style.display="none";M.$("#send_sms_captcha_a").style.display="";return}M.$("#sms_capteha_send").style.display="";M.$("#send_sms_captcha_wait").innerHTML=US.smsCaptchaTimer+"秒后重新发送";US.smsCaptchaTimer--;setTimeout(US.countSmsCaptcha,1000)},addEventListener:function(a,c,b){if(!a){return}if(typeof a.addEventListener!="undefined"){a.addEventListener(c,b,false)}else{if(typeof a.attachEvent!="undefined"){a.attachEvent("on"+c,function(){b.apply(a,arguments)})}else{a["on"+c]=b}}},stringLength:function(a){return a.length},focusPrev:function(){UD=this.setting;US.showSuccess();if(UD.keyName!="captcha"){US.showError(false,UD.defaultTip)}if(UD.focusFunction){UD.focusFunction()}},blurPrev:function(){US.checkFunction.apply(this,arguments);if(UD.blurFunction){UD.blurFunction.apply(this,arguments)}},checkValueOnline:function(d){var b=UD;if(UD.detection!=true){option.ajaxTime++}var c=UD.ajaxUrl;var a=c.indexOf("?")>=0?"&":"?";c+=a+UD.keyName+"="+encodeURIComponent(d);if(UD.extraData){c+=(UD.extraData()||"").replace(/^\?/,function(){return c.indexOf("?")>=0?"&":"?"})}M.ajax({type:"GET",url:c,dataType:"json",cache:false,success:function(e){if(UD.detection!=true){option.ajaxTime--}if(e){if(b&&b.fixJson){e=b.fixJson(e)}US.ajaxCallBack(e,b)}}})},ajaxCallBack:function(a,c){if(c.type){if(a.error==1&&a.msg.indexOf("已经存在")>=0){if(a.flag||a.flag==1){US.showError(true,a.msg,c)}else{US.showSuccess(true,c)}if(c.type==1){window.canSubmit=null}}else{if(c.type==1&&c.detection!=true){window.canSubmit=true}var b=c.ruleError;US.showError(true,b,c)}if(a.chapter_flag==0){M.setCookie("login_need_captcha","yes",-1);hideCaptchaLogin()}else{if(a.chapter_flag==1){M.setCookie("login_need_captcha","yes","session");showCaptchaLogin()}}}else{if(a.error==0||a.msg=="success"){US.showSuccess(true,c)}else{var b=a.msg=="error"?c.lengthError:a.msg;US.showError(true,b,c)}}if(option.regSub){option.regSub=false;US.formSubmit()}},checkFunction:function(){var f=this.value,b=US.stringLength(f),c=UD.maxLength,d=UD.minLength,e=UD.pattent;var a=UD.keyName;if(a!="captcha"){if(b==0||f==UD.defaultValue){return}if((c&&b>c)||(d&&b<d)){US.showError(true,UD.lengthError)}else{if(UD.pattent&&!UD.pattent.test(f)){US.showError(true,UD.ruleError)}else{if(UD.checkOnline){US.checkValueOnline(f)}else{if(UD.checkPassword&&UD.pwElem.value!=f){US.showError(true,UD.ruleError)}else{if(UD.extendPattent&&UD.extendPattent.test(f)){US.showError(true,UD.extendError)}else{US.showSuccess(true)}}}}}}},showError:function(b,a,c){var d=c||window.UD;a=a||"";if(b){M.addClass(d.elem,"users_input_error");M.addClass(d.errorElem,"error2");d.errorElem.innerHTML=a;$(d.errorElem).css({visibility:"visible"})}else{M.removeClass(d.elem,"users_input_error");M.removeClass(d.errorElem,"error2");if(a){d.errorElem.innerHTML=a}else{d.errorElem.style.visibility="hidden"}}},showSuccess:function(a,b){var c=b||window.UD;if(c.type){if(a){option.loginCheck=true}}else{if(a){US.showError();c.successElem.style.display="";c.errorElem.style.visibility="hidden";option.registerCheck[c.checkKey]=false}else{c.successElem.style.display="none";option.registerCheck[c.checkKey]=true}}},changeCaptcha:function(b,a,d){if(!b){return}if(b&&b.parentNode&&b.parentNode.tagName.toLowerCase()=="p"&&b.parentNode.tagName.display=="none"){return}if(!a){b=[b];a=true}if(d){var c=b[0];while(c){c=c.previousSibling;if(c&&c.nodeName=="INPUT"){c.value="";c.focus();break}}}M.ajax({url:"/user/?act=get_captcha",cache:false,dataType:"html",success:function(g){for(var e=0,f=b.length;e<f;e++){b[e].src=g;b[e].setAttribute("title","看不清换一张")}},error:function(){}})},formSubmit:function(){if(option.ajaxTime>0){return}var b=US.serialize(SB.id),a;var d=false;if(SB.type==1){if(window.canSubmit){return false}if(!option.loginCheck){d=true}if(b.username2==""||b.username2==UD.defaultValue){var c="请输入邮箱/用户名/已验证手机";if(window.loginType&&window.loginType=="expr"){c="请输入已验证手机"}$("#login_uname_a").addClass("error2").html(c).css("visibility","visible");d=true}if(b.password2==""){$("#login_uname_p_a").addClass("error2").html("请输入密码").css("visibility","visible");d=true}if(d){return false}}else{a=option.registerCheck;for(var e in b){if(a[e]&&e!="captcha"){return false}}b=M.extend(b,{type:option.userType})}SB.submitWaiting&&SB.submitWaiting();if(b.type==2){b.email=b.username}var g="/user/?act="+b.act;if(b.act=="act_login_ajax"){g="/act_login_ajax/"}M.ajax({url:g,type:"POST",cache:false,dataType:"json",data:b,success:SB.submitFunction,error:SB.submitErrorFun})},serialize:function(c){var a=document.getElementById(c);var b,d,f={};for(b=0;b<a.elements.length;b++){if(a.elements[b].name===""){continue}if(a.elements[b].parentNode&&a.elements[b].parentNode.tagName.toLowerCase()=="p"&&a.elements[b].parentNode.style.display=="none"){continue}var e=a.elements[b].name;switch(a.elements[b].nodeName){case"INPUT":switch(a.elements[b].type){case"text":case"hidden":case"password":if(!a.elements[b].disabled){f[e]=a.elements[b].value}break;case"checkbox":if(!!a.elements[b].checked){f[e]=1}else{f[e]=0}break}break}}return f}};function AuthPasswd(c){if(c.length>=6){var d=0;c.match(/[a-z]/g)&&d++;c.match(/[A-Z]/g)&&d++;c.match(/[0-9]/g)&&d++;c.match(/[^a-zA-Z0-9]/g)&&d++;d=d>3?3:(d-1);c.length<8&&d>1&&(d=1);noticeAssign(d)}else{US.showError(false,UD.defaultTip)}}function noticeAssign(c){var a="";switch(c){case 1:a='<span style="color:#169021;">弱</span>';break;case 2:a='<span style="color:#FF7300;">中</span>';break;case 3:a='<span style="color:#E20001;">强</span>';break;default:a=""}if(a!=""){var b='密码强度：<span class="pwd pwd_'+c+'"></span>'+a;if(document.getElementById("register_password_a")){document.getElementById("register_password_a").innerHTML=b}if(document.getElementById("find_password_a")){document.getElementById("find_password_a").innerHTML=b}}}var RSB={type:0,id:"JS_register_form",elem1:M.$("#register_submit0"),elem2:M.$("#register_submit1"),submitWaiting:function(){RSB.elem1.style.display="none";RSB.elem2.style.display="block"},submitFunction:function(a){if(a.error==0){M.setWindowName("js","parseGaData","_trackEvent","userRegister",document.referrer,"网页注册");var c=a.url;M.$("#JS_register_success").href=c||"/";var d=M.$("#append").innerHTML,b=M.$("#register_username").value;if(0&&option.userType==3){}else{d=d.replace("{登录}",(function(f){var g=f.split("@");if(g&&g.length==2){var h={"qq.com":"http://mail.qq.com","vip.qq.com":"http://mail.qq.com","163.com":"http://mail.163.com","yahoo.com.cn":"http://mail.cn.yahoo.com/","yahoo.cn":"http://mail.cn.yahoo.com/","126.com":"http://www.126.com/","gmail.com":"http://mail.google.com","hotmail.com":"http://www.hotmail.com","sina.com":"http://mail.sina.com.cn/","139.com":"http://mail.10086.cn/","tom.com":"http://mail.tom.com/","21cn.com":"http://mail.21cn.com/","sogou.com":"http://mail.sogou.com/","189.cn":"http://webmail3.189.cn/webmail/","eyou.com":"http://www.eyou.com/","yeah.net":"http://www.yeah.net/","sohu.com":"http://mail.sohu.com/","foxmail.com":"http://www.foxmail.com/","wo.com.cn":"http://mail.wo.com.cn/mail/login.action","263.net":"http://www.263.net/","live.com":"http://www.live.com"};var i=h[g[1]]}return i?'<a class="red" href="'+i+'" target="_blank">登录</a>':"登录"})(a.email||b||""))}var e;if(a.type==1){e="/user/?act=regist_emailsuccess&username="+a.username}else{if(a.type==2){e="/user/?act=regist_phonesuccess&username="+a.username}else{e="/user/?act=regist_namesuccess&username="+a.username}}location.href=e}else{RSB.submitErrorFun(a.msg)}},submitErrorFun:function(a){M.$("#register_password").value="";M.$("#register_confirm_password").value="";M.$("#register_confirm_password_a").innerHTML="请输入密码";M.$("#register_confirm_password_a").className="error error2";M.$("#register_confirm_password_a").style.visibility="visible";M.$("#register_captcha").value="";M.$("#register_password").focus();RSB.elem1.style.display="block";RSB.elem2.style.display="none";US.changeCaptcha(M.$("#JS_captcha"),"",true);M.alert(a||"注册失败，请刷新后重试")}};var LSB={type:1,id:"JS_login_form",elem1:M.$("#login_submit0"),elem2:M.$("#login_submit1"),pwElem:M.$("#login_uname_p"),submitWaiting:function(){LSB.elem1.style.display="none";LSB.elem2.style.display="block"},submitFunction:function(a){if(a&&a.chapter_flag){showCaptchaLogin();M.setCookie("login_need_captcha","yes","session")}if(a.error==0){M.setWindowName("js","parseGaData","_trackEvent","userLogin",document.referrer,"网页登录");if(M.$("#JS_rember_username").checked){M.setCookie("rember_username",M.$("#login_uname").value)}else{M.setCookie("rember_username",0,-1)}var b=a.url;b=b||"/";M.setCookie("login_need_captcha","yes",-1);location.href=b}else{msg=a.msg||a.message;LSB.submitErrorFun(msg)}},submitErrorFun:function(a){LSB.elem1.style.display="block";LSB.elem2.style.display="none";M.alert(a||"登录失败！请稍后重试！")}};var SB=null;